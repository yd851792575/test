# ElasticSearch第一天

## 一、ElasticSearch简介

~~~
ElasticSearch是一个基于Lucene的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。
~~~

全文检索：针对文本中每个词，创建词条建立索引，进行搜索。

## 二、ElasticSearch安装与启动



#### 1、安装ES服务

~~~
解压即安装完毕
~~~

#### 2、启动ES服务

~~~
点击ElasticSearch下的bin目录下的elasticsearch.bat启动服务
~~~

#### 3、访问测试

~~~
http://localhost:9200/
~~~

注意：需要安装1.8及以上版本jdk，并配置好JDK环境变量。否则启动ElasticSearch失败。



## 三、安装ES的图形化界面插件

#### 1、安装图形化界面head插件

~~~
解压elasticsearch-head-master.zip到任意目录
~~~

#### 2、安装nodejs程序

~~~
Grunt和所有grunt插件都是基于nodejs来运行的
~~~

#### 3、grunt安装为全局命令

Grunt是一个基于JavaScript上的一个很强大的前端自动化工具基于NodeJS用于自动化构建、测试、生成文档的项目管理工具。

~~~
cmd控制台中输入：  npm install -g grunt-cli
~~~

**设置允许elasticsearch跨越访问**

~~~
修改elasticsearch-5.6.8\config下的elasticsearch.yml文件：

http.cors.enabled: true        # 开启跨域访问支持，默认为false
http.cors.allow-origin: "*"    # 跨域访问允许的域名地址
~~~

**cmd命令进入elasticsearch-head-master目录，启动head图形化界面程序：**

~~~
grunt server
~~~

如果grunt server不好用：

cmd进入到head目录中执行npm install



#### 4、测试查询

~~~
 http://localhost:9100
~~~



## 四、ElasticSearch相关概念

​	索引(Indices)、类型(type)、文档(document)、映射 (相当于表结构)



## 五、ElasticSearch操作入门

#### 1、创建Maven工程，引入ElasticSearch坐标 

~~~xml

    <dependencies>
        <dependency>
            <groupId>org.elasticsearch</groupId>
            <artifactId>elasticsearch</artifactId>
            <version>5.6.8</version>
        </dependency>
        <dependency>
            <groupId>org.elasticsearch.client</groupId>
            <artifactId>transport</artifactId>
            <version>5.6.8</version>
        </dependency>
        <dependency>
            <groupId>org.apache.logging.log4j</groupId>
            <artifactId>log4j-to-slf4j</artifactId>
            <version>2.9.1</version>
        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
            <version>1.7.24</version>
        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-simple</artifactId>
            <version>1.7.21</version>
        </dependency>
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>1.2.12</version>
        </dependency>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.10</version>
        </dependency>


    </dependencies>


~~~

---



#### 2、新建索引

~~~java
    @Test
    //创建索引
    public void test1() throws Exception {
        //创建客户端访问对象
        TransportClient client = new PreBuiltTransportClient(Settings.EMPTY).addTransportAddress(
                new InetSocketTransportAddress(InetAddress.getByName("127.0.0.1"), 9300));

        //创建文档对象
        //{id:1,title:"xxx",content:"xxxxxx"}
        XContentBuilder builder = XContentFactory.jsonBuilder().startObject()
                .field("id", "1")
                .field("title", "ElasticSearch是一个基于Lucene的搜索服务器。")
                .field("content", "它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，" +
                        "是当前流行的企业级搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。")
                .endObject();
        //创建索引
        client.prepareIndex("blog1","article","1").setSource(builder).get();//执行动作

        //关闭资源
        client.close();
    }
~~~

---



#### 3、head插件查看索引信息

~~~
http://localhost:9100
~~~

---



## 六、搜索文档数据

#### 1、查询全部

~~~java
    @Test
    //查询全部
    public void test2() throws Exception {

        //创建客户端访问对象
        TransportClient client = new PreBuiltTransportClient(Settings.EMPTY)
                .addTransportAddress(new
                        InetSocketTransportAddress(InetAddress.getByName("127.0.0.1"), 9300));

        //设置查询条件
        SearchResponse searchResponse = client.prepareSearch("bolg1").setTypes("article").setQuery(QueryBuilders.matchAllQuery()).get();

        //处理结果
        SearchHits hits = searchResponse.getHits();  //获得命中目标，即查询到了多少个对象
        System.out.println("共查询"+hits.getTotalHits()+"条");
        Iterator<SearchHit> ite = hits.iterator();
        while(ite.hasNext()){
            SearchHit searchHit = ite.next();
            System.out.println(searchHit.getSourceAsString());
            System.out.println(searchHit.getSource().get("title"));
        }
        //关闭资源
        client.close();
    }
~~~



#### 2、字符串查询





#### 3、词条查询





#### 4、模糊查询



## 七、IK 分词器和ElasticSearch集成使用

#### 1、上述查询存在问题分析

在进行词条查询时，我们搜索"搜索"却没有搜索到数据！

#### 2、IK分词器简介

~~~
IKAnalyzer是一个开源的，基于java语言开发的轻量级的中文分词工具包。
~~~

#### 3、ElasticSearch集成IK分词器

##### **3.1  IK分词器的安装**

~~~
1. 解压elasticsearch-analysis-ik-2.x后,将文件夹拷贝到elasticsearch-5.6.8\plugins下，并重命名文件夹为ik
2. 重新启动ElasticSearch，即可加载IK分词器
~~~

---

##### 3.2  IK分词器测试

~~~
IK提供了两个分词算法ik_smart 和 ik_max_word

1）最小切分：在浏览器地址栏输入地址
http://127.0.0.1:9200/_analyze?analyzer=ik_smart&pretty=true&text=我是程序员

2）最细切分：在浏览器地址栏输入地址
http://127.0.0.1:9200/_analyze?analyzer=ik_max_word&pretty=true&text=我是程序员

~~~

---

#### 4、疑问？

在ElasticSearch没有索引的情况下，插入文档，默认创建索引和索引映射是无法使用IK分词器的。

